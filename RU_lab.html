<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />


<meta name="author" content="Nina Branten" />


<title>Webscraping data sociology Radboud University</title>

<script src="site_libs/header-attrs-2.16/header-attrs.js"></script>
<script src="site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/flatly.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<script src="site_libs/navigation-1.1/codefolding.js"></script>
<script src="site_libs/navigation-1.1/sourceembed.js"></script>
<link href="site_libs/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>
<script src="site_libs/clipboard-1.7.1/clipboard.min.js"></script>
<link href="site_libs/primer-tooltips-1.4.0/build.css" rel="stylesheet" />
<link href="site_libs/klippy-0.0.0.9500/css/klippy.min.css" rel="stylesheet" />
<script src="site_libs/klippy-0.0.0.9500/js/klippy.min.js"></script>
<link href="site_libs/font-awesome-5.1.0/css/all.css" rel="stylesheet" />
<link href="site_libs/font-awesome-5.1.0/css/v4-shims.css" rel="stylesheet" />

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>

<style type="text/css">code{white-space: pre;}</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>




<style type="text/css">
#rmd-source-code {
  display: none;
}
</style>


<link rel="stylesheet" href="tweaks.css" type="text/css" />



<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
details > summary > p:only-child {
  display: inline;
}
pre code {
  padding: 0;
}
</style>


<style type="text/css">
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #adb5bd;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script type="text/javascript">
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark the anchor link active (and if it's in a dropdown, also mark that active)
  var dropdown = menuAnchor.closest('li.dropdown');
  if (window.bootstrap) { // Bootstrap 4+
    menuAnchor.addClass('active');
    dropdown.find('> .dropdown-toggle').addClass('active');
  } else { // Bootstrap 3
    menuAnchor.parent().addClass('active');
    dropdown.addClass('active');
  }

  // Navbar adjustments
  var navHeight = $(".navbar").first().height() + 15;
  var style = document.createElement('style');
  var pt = "padding-top: " + navHeight + "px; ";
  var mt = "margin-top: -" + navHeight + "px; ";
  var css = "";
  // offset scroll position for anchor links (for fixed navbar)
  for (var i = 1; i <= 6; i++) {
    css += ".section h" + i + "{ " + pt + mt + "}\n";
  }
  style.innerHTML = "body {" + pt + "padding-bottom: 40px; }\n" + css;
  document.head.appendChild(style);
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->
<style type="text/css">
.code-folding-btn { margin-bottom: 4px; }
</style>



<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}

@media print {
.toc-content {
  /* see https://github.com/w3c/csswg-drafts/issues/4434 */
  float: right;
}
}

.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-bs-toggle="collapse" data-target="#navbar" data-bs-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html"></a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">
    <span class="fa fa-home"></span>
     
  </a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    My journal
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="lab1.html">Week 1</a>
    </li>
    <li>
      <a href="week-2-plotting.html">Week 2</a>
    </li>
    <li>
      <a href="RU_lab.html">Week 3/4 - RU</a>
    </li>
    <li>
      <a href="RSiena_tutorial.html">Week 4</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Research Question
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="RQ1.html">first attempt</a>
    </li>
    <li>
      <a href="RQ2.html">second attempt</a>
    </li>
    <li>
      <a href="RQ3.html">third attempt</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Final report
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="intro_report.html">Intro</a>
    </li>
  </ul>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/JochemTolsma/labjournal">
    <span class="fab fa-github"></span>
     
  </a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div id="header">

<div class="btn-group pull-right float-right">
<button type="button" class="btn btn-default btn-xs btn-secondary btn-sm dropdown-toggle" data-toggle="dropdown" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><span>Code</span> <span class="caret"></span></button>
<ul class="dropdown-menu dropdown-menu-right" style="min-width: 50px;">
<li><a id="rmd-show-all-code" href="#">Show All Code</a></li>
<li><a id="rmd-hide-all-code" href="#">Hide All Code</a></li>
<li role="separator" class="divider"></li>
<li><a id="rmd-download-source" href="#">Download Rmd</a></li>
</ul>
</div>



<h1 class="title toc-ignore">Webscraping data sociology Radboud
University</h1>
<h4 class="author">Nina Branten</h4>

</div>


<pre class="r"><code>library(knitr)

knitr::opts_chunk$set(echo = TRUE)
opts_chunk$set(tidy.opts=list(width.cutoff=100),tidy=TRUE, warning = FALSE, message = FALSE,comment = &quot;#&gt;&quot;, cache=TRUE, class.source=c(&quot;test&quot;), class.output=c(&quot;test2&quot;))
options(width = 100)
rgl::setupKnitr()



colorize &lt;- function(x, color) {sprintf(&quot;&lt;span style=&#39;color: %s;&#39;&gt;%s&lt;/span&gt;&quot;, color, x) }</code></pre>
<pre class="r test"><code>klippy::klippy(position = c(&#39;top&#39;, &#39;right&#39;))</code></pre>
<script>
  addClassKlippyTo("pre.r, pre.markdown");
  addKlippy('right', 'top', 'auto', '1', 'Copy code', 'Copied!');
</script>
<pre class="r test"><code>#klippy::klippy(color = &#39;darkred&#39;)
#klippy::klippy(tooltip_message = &#39;Click to copy&#39;, tooltip_success = &#39;Done&#39;)</code></pre>
<pre class="r test"><code>#start with clean workspace 
rm(list=ls())
getwd()</code></pre>
<pre class="test2"><code>#&gt; [1] &quot;C:/Users/ninab/OneDrive/Documenten/GitHub/labjournal&quot;</code></pre>
<div id="packages" class="section level1" number="1">
<h1><span class="header-section-number">1</span> packages</h1>
<pre class="r test"><code>#install.packages(&quot;data.table&quot;) 
library(data.table) # mainly for faster data handling
library(tidyverse) # I assume you already installed this one!
# install.packages(&quot;httr&quot;) # we don&#39;t need this for now
# require(httr)
#install.packages(&quot;xml2&quot;)
require(xml2)
#install.packages(&quot;rvest&quot;)
require(rvest)
#install.packages(&quot;devtools&quot;)
require(devtools)
# Note we&#39;re doing something different here. We&#39;re installing a *latest* version directly from GitHub
# This is because the released version of this packages contains some errors!
#devtools::install_github(&quot;jkeirstead/scholar&quot;) 


require(scholar)

#define workdirectory, note the double *backslashes* if you&#39;re on windows
# setwd(&quot;/yourpathhere)&quot;</code></pre>
</div>
<div id="saving-webpage" class="section level1" number="2">
<h1><span class="header-section-number">2</span> saving webpage</h1>
<pre class="r test"><code># Let&#39;s first get the staff page read_html is a function that simply extracts html webpages and
# puts them in xml format
soc_staff &lt;- read_html(&quot;https://www.ru.nl/sociology/research/staff/&quot;)

#head(soc_staff)
#class(soc_staff)</code></pre>
</div>
<div id="making-data-with-names" class="section level1" number="3">
<h1><span class="header-section-number">3</span> making data with
names</h1>
<div id="selecting-the-table-with-names" class="section level2"
number="3.1">
<h2><span class="header-section-number">3.1</span> selecting the table
with names</h2>
<pre class="r test"><code>soc_staff &lt;- soc_staff %&gt;%
    rvest::html_nodes(&quot;body&quot;) %&gt;%
    xml2::xml_find_all(&quot;//td&quot;) %&gt;%
    rvest::html_text()</code></pre>
</div>
<div id="selecting-only-the-odd-rowes-with-the-names"
class="section level2" number="3.2">
<h2><span class="header-section-number">3.2</span> selecting only the
odd rowes with the names</h2>
<pre class="r test"><code>fodd &lt;- function(x) {
  #what is x, x is a vector
 x%%2 != 0 
}

nstaf &lt;- length(soc_staff)

soc_names &lt;- soc_staff[fodd(1:nstaf)] 
head(soc_names)</code></pre>
</div>
<div id="selecting-only-the-even-rowes-with-the-expertise"
class="section level2" number="3.3">
<h2><span class="header-section-number">3.3</span> selecting only the
even rowes with the expertise</h2>
<pre class="r test"><code>soc_experts &lt;- soc_staff[!fodd(1:nstaf)]
head(soc_experts)</code></pre>
</div>
<div id="combining-names-and-expertise-in-soc_df" class="section level2"
number="3.4">
<h2><span class="header-section-number">3.4</span> combining names and
expertise in soc_df</h2>
<pre class="r test"><code>soc_df &lt;- data.frame(cbind(soc_names, soc_experts)) 
save(soc_df, file = &quot;names_experts.RData&quot;)</code></pre>
<pre class="r test"><code>load(&quot;names_experts.RData&quot;)</code></pre>
</div>
</div>
<div id="cleaning-the-dataset" class="section level1" number="4">
<h1><span class="header-section-number">4</span> Cleaning the
dataset</h1>
<div id="delete-rows-without-name-info" class="section level2"
number="4.1">
<h2><span class="header-section-number">4.1</span> delete rows without
name info</h2>
<pre class="r test"><code># inspect again, and remove the rows we don&#39;t need (check for yourself to be certain!)

delrows &lt;- which(soc_df$soc_names == &quot;Staff:&quot; | soc_df$soc_names == &quot;PhD:&quot; | soc_df$soc_names == &quot;External PhD:&quot; |
    soc_df$soc_names == &quot;Guest researchers:&quot; | soc_df$soc_names == &quot;Other researchers:&quot;)

soc_df &lt;- soc_df[-delrows, ]</code></pre>
</div>
<div id="cleaning-the-names" class="section level2" number="4.2">
<h2><span class="header-section-number">4.2</span> cleaning the
names</h2>
<pre class="r test"><code># Last name seems to be everything before the comma
soc_df$last_name &lt;- gsub(&quot;,.*$&quot;, &quot;&quot;, soc_df$soc_names)

# first name is everything between brackets
soc_df$first_name &lt;- as.character(str_extract_all(soc_df$soc_names, &quot;(?&lt;=\\().+?(?=\\))&quot;, simplify = TRUE))</code></pre>
<pre class="r test"><code>soc_df$last_name &lt;- gsub(&quot; J. \\(Jansje\\) van MSc&quot;, &quot;&quot;, soc_df$last_name)
soc_df$first_name &lt;- tolower(soc_df$first_name)  # everything to lower!
soc_df$last_name &lt;- tolower(soc_df$last_name)</code></pre>
</div>
<div id="loose-double-names" class="section level2" number="4.3">
<h2><span class="header-section-number">4.3</span> Loose double
names</h2>
<pre class="r test"><code># trimws looses all spacing before and after (if you specify &#39;both&#39;) a character string
soc_df$last_name &lt;- trimws(soc_df$last_name, which = c(&quot;both&quot;), whitespace = &quot;[ \t\r\n]&quot;)
soc_df$first_name &lt;- trimws(soc_df$first_name, which = c(&quot;both&quot;), whitespace = &quot;[ \t\r\n]&quot;)

soc_df$first_name &lt;- as.character(str_split(soc_df$first_name, pattern=&quot; &quot;, n = 2, simplify = TRUE)[,1])
soc_df$first_name &lt;- as.character(str_split(soc_df$first_name, pattern=&quot;-&quot;, n = 2, simplify = TRUE)[,1])

#removing strange characters
soc_df$first_name &lt;- iconv(soc_df$first_name, from = &#39;UTF-8&#39;, to = &#39;ASCII//TRANSLIT&#39;)

soc_df$soc_experts &lt;- trimws(soc_df$soc_experts, which = c(&quot;both&quot;), whitespace = &quot;[ \t\r\n]&quot;)
soc_df$soc_names &lt;- trimws(soc_df$soc_names, which = c(&quot;both&quot;), whitespace = &quot;[ \t\r\n]&quot;)
soc_df$first_name</code></pre>
<pre class="test2"><code>#&gt;  [1] &quot;ronald&quot;     &quot;katia&quot;      &quot;hidde&quot;      &quot;lonneke&quot;    &quot;lieselotte&quot; &quot;rob&quot;        &quot;maurice&quot;   
#&gt;  [8] &quot;nella&quot;      &quot;saskia&quot;     &quot;margriet&quot;   &quot;remco&quot;      &quot;bas&quot;        &quot;judith&quot;     &quot;gerbert&quot;   
#&gt; [15] &quot;roza&quot;       &quot;michael&quot;    &quot;peer&quot;       &quot;niels&quot;      &quot;jochem&quot;     &quot;ellen&quot;      &quot;mark&quot;      
#&gt; [22] &quot;maarten&quot;    &quot;carlijn&quot;    &quot;rob&quot;        &quot;mustafa&quot;    &quot;aysegul&quot;    &quot;inge&quot;       &quot;thijmen&quot;   
#&gt; [29] &quot;rachel&quot;     &quot;nik&quot;        &quot;renae&quot;      &quot;maikel&quot;     &quot;carly&quot;      &quot;anne&quot;       &quot;katrin&quot;    
#&gt; [36] &quot;klara&quot;      &quot;marlou&quot;     &quot;sara&quot;       &quot;janos&quot;      &quot;jansje&quot;     &quot;elize&quot;      &quot;tijmen&quot;    
#&gt; [43] &quot;elissa&quot;     &quot;carl&quot;       &quot;paul&quot;       &quot;malou&quot;</code></pre>
<pre class="r test"><code>save(soc_df, file=&quot;soc_df_s1.RData&quot;)</code></pre>
</div>
</div>
<div id="adding-gender-to-dataset" class="section level1" number="5">
<h1><span class="header-section-number">5</span> adding gender to
dataset</h1>
<div id="fgender" class="section level2" number="5.1">
<h2><span class="header-section-number">5.1</span> fgender</h2>
<pre class="r test"><code>fgender &lt;- function(soc_df, me, file=NULL) {

####################################
# Author: Bas Hofstra, Anne Maaike Mulders, Jochem Tolsma
# DAte:   13-10-2021, last edit: 22-09-2022
# Tasks:  - assign gender baed on name
#         - Adapted from Rense Corten code April 2021
####################################


#Input: 
#  - firstname_df: a data.frame with a column named firstname  
#  - me: a character vector introducing yourself: e.g. &quot;J Tolsma, Radboud University&quot;
#  - file: location and name of file to be saved. 
  
#------------------------------------------------------------------------------------
# Load required packages

if (!require(&quot;tidyverse&quot;, character.only = TRUE)) {
  install.packages(&quot;tidyverse&quot;, dependencies = TRUE)
  library(tidyverse, character.only = TRUE)
}

if (!require(&quot;rvest&quot;, character.only = TRUE)) {
  install.packages(&quot;rvest&quot;, dependencies = TRUE)
  library(rvest, character.only = TRUE)
}

if (!require(&quot;polite&quot;, character.only = TRUE)) {
  install.packages(&quot;polite&quot;, dependencies = TRUE)
  library(polite, character.only = TRUE)
}



# make links to scrape
soc_df$name_url &lt;- paste0(&quot;https://www.meertens.knaw.nl/nvb/naam/is/&quot;, soc_df[, c(&quot;firstname&quot;)])



#------------------------------------------------------------------------------------
### 2: introduce to server ###

# Introduce myself to the server
session &lt;- bow(&quot;https://www.meertens.knaw.nl/nvb/naam/is&quot;, user_agent = me , delay = 1)


#------------------------------------------------------------------------------------
### 3: make function to get table from ###
  fnames &lt;- function(link){ 
    name_session &lt;-nod(session, path = link)
    name_page &lt;- scrape(name_session) 
    return(name_page)
  }
  
name_list &lt;- list()
table_list &lt;- list()
soc_df$gender &lt;- NA

  for (i in 1:nrow(soc_df)) {
    print(i)
    name_list[[i]] &lt;- fnames(soc_df[i, c(&quot;name_url&quot;)])
    # extract name frequency table and gender info
    table_list[[i]] &lt;- name_list[[i]] %&gt;% html_table()
    
    table_list[[i]][[1]][table_list[[i]][[1]]==&quot;--&quot;] &lt;- &quot;0&quot;
    
    if (as.numeric(table_list[[i]][[1]]$X3[2]) &gt; as.numeric(table_list[[i]][[1]]$X3[6])) {
      soc_df$gender[i] &lt;- &quot;male&quot; } else {
        soc_df$gender[i] &lt;- &quot;female&quot;
      }
    
    if (!is.null(file)) (save(soc_df, file=file))
    
    }
  return(soc_df)
}</code></pre>
</div>
<div id="gender-to-soc_df" class="section level2" number="5.2">
<h2><span class="header-section-number">5.2</span> gender to soc_df</h2>
<pre class="r test"><code>soc_df %&gt;% mutate(firstname=first_name) -&gt; soc_df

soc_df$firstname
soc_df &lt;- fgender(soc_df, me=&quot;Jochem Tolsma, RU/RUG&quot;)</code></pre>
<pre class="r test"><code>save(soc_df, file=&quot;soc_df_s2.RData&quot;)</code></pre>
<pre class="r test"><code>load(&quot;soc_df_s2.RData&quot;)</code></pre>
</div>
<div id="affiliation" class="section level2" number="5.3">
<h2><span class="header-section-number">5.3</span> affiliation</h2>
<pre class="r test"><code># set affiliation to radboud, comes in handy for querying google scholar
soc_df$affiliation &lt;- &quot;radboud university&quot;</code></pre>
</div>
</div>
<div id="harvesting-data-from-google-scholar" class="section level1"
number="6">
<h1><span class="header-section-number">6</span> harvesting data from
google scholar</h1>
<pre class="r test"><code>#require(scholar)

get_scholar_id_fix &lt;- function (last_name = &quot;&quot;, first_name = &quot;&quot;, affiliation = NA)
{
  if (!any(nzchar(c(first_name, last_name))))
    stop(&quot;At least one of first and last name must be specified!&quot;)
  site &lt;- getOption(&quot;scholar_site&quot;)
  url &lt;- paste0(site, &quot;/citations?view_op=search_authors&amp;mauthors=&quot;,
                first_name, &quot;+&quot;, last_name, &quot;&amp;hl=en&amp;oi=ao&quot;)
  page &lt;- get_scholar_resp(url)
  if (is.null(page))
    return(NA)
  aa &lt;- httr::content(page, as = &quot;text&quot;)
  # added by Bas Hofstra: bugfix for IDs that have a dash (&quot;-&quot;)
  ids &lt;- substring(aa, regexpr(&quot;;user=&quot;, aa))
  ids &lt;- substr(ids, 1, 19) # error prone, but unsure how to solve otherwise
  # if (nchar(stringr::str_extract_all(string = aa, pattern = &quot;;user=[[:alnum:]]+[[:punct:]]&quot;)[[1]][1]) &lt; 18) {
  #   ids &lt;- stringr::str_extract_all(string = aa, pattern = &quot;;user=[[:alnum:]]+[[:punct:]]+[[:alnum:]]+[[:punct:]]&quot;)
  # } else {
  #   ids &lt;- stringr::str_extract_all(string = aa, pattern = &quot;;user=[[:alnum:]]+[[:punct:]]&quot;)
  # }
  if (length(unlist(ids)) == 0) {
    message(&quot;No Scholar ID found.&quot;)
    return(NA)
  }
  ids &lt;- ids %&gt;% unlist %&gt;% gsub(&quot;;user=|[[:punct:]]$&quot;, &quot;&quot;,
                                 .) %&gt;% unique
  if (length(ids) &gt; 1) {
    profiles &lt;- lapply(ids, scholar::get_profile)
    if (is.na(affiliation)) {
      x_profile &lt;- profiles[[1]]
      warning(&quot;Selecting first out of &quot;, length(profiles),
              &quot; candidate matches.&quot;)
    }
    else {
      which_profile &lt;- sapply(profiles, function(x) {
        stringr::str_count(string = x$affiliation, pattern = stringr::coll(affiliation,
                                                                           ignore_case = TRUE))
      })
      if (all(which_profile == 0)) {
        warning(&quot;No researcher found at the indicated affiliation.&quot;)
        return(NA)
      }
      else {
        x_profile &lt;- profiles[[which(which_profile !=
                                       0)]]
      }
    }
  }
  else {
    x_profile &lt;- scholar::get_profile(id = ids)
  }
  return(x_profile$id)
}</code></pre>
<div id="scholars-id." class="section level2" number="6.1">
<h2><span class="header-section-number">6.1</span> scholars id.</h2>
<p>Remove staff members without scholar ids.</p>
<pre class="r test"><code>soc_df$gs_id &lt;- &quot;&quot;

for (i in 1:nrow(soc_df)) {
  print(i)
  time &lt;- runif(1, 0, 1)
  Sys.sleep(time)

  tryCatch({
     soc_df[i,c(&quot;gs_id&quot;)] &lt;- get_scholar_id_fix(last_name = soc_df[i, c(&quot;last_name&quot;)], # so search on last_name of staff (third column)
                                             first_name = soc_df[i, c(&quot;first_name&quot;)],  # search on first_name of staff (fourth column)
                                             affiliation = soc_df[i,c(&quot;affiliation&quot;)]) # search on affiliation of each staff (fifth column)

    }, error=function(e){cat(&quot;ERROR :&quot;, conditionMessage(e), &quot;\n&quot;)}) # continue on error, but print the error
  }

# remove those without pubs from the df
# seems we&#39;re left with about 34 sociology staff members!
soc_df_copy &lt;- soc_df #just to also have the data with staff without scholar_id
soc_df &lt;- soc_df[!soc_df$gs_id == &quot;&quot;, ]</code></pre>
<pre class="r test"><code>save(soc_df, file=&quot;soc_df_s3.RData&quot;)
save(soc_df_copy, file=&quot;soc_df_copy.RData&quot;)</code></pre>
<pre class="r test"><code>load(&quot;soc_df_s3.RData&quot;)</code></pre>
</div>
</div>
<div id="publications-and-profiles" class="section level1" number="7">
<h1><span class="header-section-number">7</span> publications and
profiles</h1>
<p>We save the publications and info of the scholar profiles in new
objects.</p>
<pre class="r test"><code>soc_list_profiles &lt;- list()  # first we create an empty list that we then fill up with the for loop
soc_list_publications &lt;- list()

time &lt;- 1 # I placed the waiting time outside the loop
i &lt;- 1 # Our loop iterator is now a variable. This means I can change it within a while loop. Using a for loop you cant change your iterator in the loop itself. 

while (i &lt;= nrow(soc_df)) {
    print(i)
    Sys.sleep(time)

   
    tryCatch({
    #In this part of the tryCatch function you put all the stuff you want to do in the loop.
    # note how you call different elements in a list &#39;[[]]&#39;, fill in the i-th element
    soc_list_profiles[[i]] &lt;- get_profile(soc_df[i, c(&quot;gs_id&quot;)])  # Note how we call row i (remember how to call rows in a DF/Matrix) and then the associated scholar id
    soc_list_publications[[i]] &lt;- get_publications(soc_df[i, c(&quot;gs_id&quot;)])
    soc_list_publications[[i]][, c(&quot;gs_id&quot;)] &lt;- soc_df[i, c(&quot;gs_id&quot;)]  # note that we again attach an id
    # so both functions here call the entire profile and pubs for an author, based on google
    # scholar ids
    i &lt;- i + 1 #IMPORTANT, YOU NEED TO TELL THE WHILE LOOP THAT YOUR ITERATOR HAS TO BE INCREASED
    },
      warning = function(w) {
        cat(&quot;WARNING:&quot;, conditionMessage(w), &quot;\n&quot;) #WARNING message
        i &lt;&lt;- i + 1}, #BUT WE DO WANT TO CONTINUE. NOTE THE DOUBLE &lt;&lt; THIS IS BECAUSE I WANT TO CHANGE A VARIABLE WHICH EXISTS OUTSIDE THE WARNING FUNCTION
      error =function(e) {
        time &lt;&lt;- min(time *10, 3600*2)
        cat(&quot;Error:&quot;, conditionMessage(e), &quot;\n&quot;) #ERROR message
        cat(&quot;sleep time:&quot;, time,  &quot;\n&quot;)
        cat(&quot;ik zit in loop&quot;, i)
        #AFTER THE NEW SLEEP TIME, WE TRY AGAIN, WE THEREFORE DO NOT UPDATE i. ideally you also want to have some break option. And maybe you also want to save your data when you hit a time out error. 
      })
   
 
}</code></pre>
<pre class="r test"><code># The 36 RU sociology scholars publish ~3000 papers
soc_df_publications &lt;- bind_rows(soc_list_publications)</code></pre>
<pre class="r test"><code>save(soc_df_publications, file=&quot;soc_df_publications.RData&quot;)
save(soc_list_profiles, file= &quot;soc_list_profiles.RData&quot;)</code></pre>
<pre class="r test"><code>load(&quot;soc_df_publications.RData&quot;)
load(&quot;soc_list_profiles.RData&quot;)</code></pre>
<div
id="put-the-info-of-the-profiles-in-our-data-set-of-staff-members-soc_df"
class="section level2" number="7.1">
<h2><span class="header-section-number">7.1</span> put the info of the
profiles in our data set of staff members soc_df</h2>
<pre class="r test"><code>soc_profiles_df &lt;- list()


for (i in 1:length(soc_list_profiles)) {
    # soc_profiles_df[[i]] &lt;- data.frame(t(unlist(soc_list_profiles[[i]][1:8]))) #some annyoing
    # data handling
  if (!is.null(soc_list_profiles[[i]])) {
    soc_profiles_df[[i]] &lt;- unlist(soc_list_profiles[[i]][1:8])
    soc_profiles_df[[i]] &lt;- data.frame(soc_profiles_df[[i]])
    soc_profiles_df[[i]] &lt;- t(soc_profiles_df[[i]])
    row.names(soc_profiles_df[[i]]) &lt;- NULL
    soc_profiles_df[[i]] &lt;- data.frame(soc_profiles_df[[i]])
  }
}

#soc_profiles_df

soc_profiles_df2 &lt;- bind_rows(soc_profiles_df)
soc_df &lt;- left_join(soc_df, soc_profiles_df2, by = c(gs_id = &quot;id&quot;))  # merge data with soc_df
soc_df  # notice all the new information we were able to get from the scholar profiles!</code></pre>
<pre class="r test"><code>save(soc_df, file=&quot;soc_df_s4.RData&quot;)</code></pre>
<pre class="r test"><code>load(&quot;soc_df_s4.RData&quot;)</code></pre>
</div>
</div>
<div id="citation-history" class="section level1" number="8">
<h1><span class="header-section-number">8</span> citation history</h1>
<pre class="r test"><code># get citation history of a scholar
soc_staff_cit &lt;- list()


time &lt;- 1 # I placed the waiting time outside the loop
i &lt;- 1 # Our loop iterator is now a variable. This means I can change it within a while loop. Using a for loop you cant change your iterator in the loop itself. 

while (i &lt;= nrow(soc_df)) {
    print(i)
    Sys.sleep(time)

    tryCatch({
      soc_staff_cit[[i]] &lt;- get_citation_history(soc_df[i, c(&quot;gs_id&quot;)])
        if (nrow(soc_staff_cit[[i]]) &gt; 0) {
          soc_staff_cit[[i]][, c(&quot;gs_id&quot;)] &lt;- soc_df[i, c(&quot;gs_id&quot;)]  # again attach the gs_id as third column
        }
    i &lt;- i + 1
    },
      warning = function(w) {
        cat(&quot;WARNING:&quot;, conditionMessage(w), &quot;\n&quot;) #WARNING message
        i &lt;&lt;- i + 1}, #BUT WE DO WANT TO CONTINUE. NOTE THE DOUBLE &lt;&lt; THIS IS BECAUSE I WANT TO CHANGE A VARIABLE WHICH EXISTS OUTSIDE THE WARNING FUNCTION
      error =function(e) {
        time &lt;&lt;- min(time *10, 3600*2)
        cat(&quot;Error:&quot;, conditionMessage(e), &quot;\n&quot;) #ERROR message
        cat(&quot;sleep time:&quot;, time,  &quot;\n&quot;)
        cat(&quot;ik zit in loop&quot;, i)
        #AFTER THE NEW SLEEP TIME, WE TRY AGAIN, WE THEREFORE DO NOT UPDATE i. ideally you also want to have some break option. And maybe you also want to save your data when you hit a time out error. 
      })

    
}
soc_staff_cit &lt;- bind_rows(soc_staff_cit)</code></pre>
<pre class="r test"><code>save(soc_staff_cit, file=&quot;soc_staff_cit.RData&quot;)</code></pre>
<pre class="r test"><code>load(&quot;soc_staff_cit.RData&quot;)</code></pre>
</div>
<div id="collaborators" class="section level1" number="9">
<h1><span class="header-section-number">9</span> collaborators</h1>
<pre class="r test"><code>require(rvest)
require(xml2)
require(tidyverse)

# function to get collaborators and names from GS profiles
fcollabs &lt;- function(gsid, lookforcollabs) {

  htmlpage1 &lt;- read_html(paste0(&quot;https://scholar.google.nl/citations?user=&quot;, gsid, &quot;&amp;hl=en&quot;)) # so we paste the google scholar id
  profilename &lt;- htmlpage1 %&gt;% html_nodes(xpath = &quot;//*/div[@id=&#39;gsc_prf_in&#39;]&quot;) %&gt;% html_text() # we extract the profile name of that google scholar page
  profilecollabs1 &lt;- as.data.frame(0) # empty df necessary for later
  profilecollabs2 &lt;- as.data.frame(0) # empty df necessary for later

  if (lookforcollabs == 1) { # so if you want to look for collabs, set function to 1

    htmlpage2 &lt;- read_html(paste0(&quot;https://scholar.google.com/citations?view_op=list_colleagues&amp;hl=en&amp;user=&quot;, gsid)) # so we paste the google scholar id
    profilecollabs1 &lt;-  htmlpage2 %&gt;% html_nodes(css=&quot;h3&quot;) %&gt;% html_text() # get names
    profilecollabs1 &lt;-  as.data.frame(profilecollabs1)

    profilecollabs2 &lt;- htmlpage2 %&gt;% html_nodes(&quot;a&quot;) %&gt;% html_attr(&quot;href&quot;) # get the link
    profilecollabs2 &lt;- profilecollabs2[seq_along(profilecollabs2) %% 2 &gt; 0]
    profilecollabs2 &lt;- substring(profilecollabs2, 23)

  }
  if (nrow(profilecollabs1)&gt;1) { # if there ARE collabs

    profilecollabs1 &lt;- as.data.frame(profilecollabs1) # we want to...
    profilecollabs2 &lt;-  as.data.frame(profilecollabs2)
    profilecollabs1[,c(&quot;coauth_id&quot;)] &lt;- profilecollabs2[,1]

    profilecollabs1[,c(&quot;gs_id&quot;)] &lt;- gsid #... add gs_ids of focal GS profile
    profilecollabs1[,c(&quot;name&quot;)] &lt;- profilename #...and the the profile name of GS profile attached

    names(profilecollabs1)[1] &lt;- &quot;coauth&quot;

  } else {
    profilecollabs1 &lt;- as.data.frame(cbind(gsid, profilename)) # if NOT looking for collabs...
    names(profilecollabs1) &lt;- c(&quot;gs_id&quot;, &quot;name&quot;) #...we only attach gs_id and profilename

  }
  return(profilecollabs1)

}</code></pre>
<pre class="r test"><code># input a google scholar id and a 1 (if you want to find collabs) or 0 (only extracting names)

soc_collabs &lt;- list()
for (i in 1:nrow(soc_df)) {
    print(i)
    time &lt;- runif(1, 0, 1)
    Sys.sleep(time)

    soc_collabs[[i]] &lt;- fcollabs(soc_df[i, c(&quot;gs_id&quot;)], 1)

}

soc_collabs &lt;- bind_rows(soc_collabs)  # bind rows, get the unique ones!
soc_collabs_unique &lt;- unique(soc_collabs[, 3]) 
soc_collabs_unique &lt;- soc_collabs_unique[!is.na(soc_collabs_unique)]
save(soc_collabs, file = &quot;soc_df_collabs1.RData&quot;)  # you notice this takes a while, so we save the data here</code></pre>
</div>
<div id="network-based-on-publications." class="section level1"
number="10">
<h1><span class="header-section-number">10</span> network based on
publications.</h1>
<p>Deze tijdsintervallen zijn waarschijnlijk te groot!</p>
<pre class="r test"><code>load(&quot;soc_df_collabs1.RData&quot;)</code></pre>
<pre class="r test"><code>library(stringr)

#empty adjacency matrix for the years 2001-2007
network2001_2007 &lt;- matrix(NA, nrow=nrow(soc_df), ncol=nrow(soc_df))

#select publications of the corresponding time era
pubs_sel &lt;- soc_df_publications %&gt;%
              mutate(author = tolower(author)) %&gt;%
              filter(year&gt;2000 &amp; year&lt;2008)

save(pubs_sel, file = &quot;soc_pubs_sel_2001_2007.RData&quot;)

#fill the matrix
for (ego in 1: nrow(soc_df)) {
  name_ego &lt;- soc_df$last_name[ego] #which ego? 
  pubs_sel2 &lt;- pubs_sel[str_detect(pubs_sel$author, name_ego),] #publications of ego
  for (alter in 1:nrow(soc_df)){
    name_alter &lt;- soc_df$last_name[alter] #which alter? 
    network2001_2007[ego,alter] &lt;- sum(str_detect(pubs_sel2$author, name_alter)) &gt; 1 #did alter publish with ego
  }
}

save(network2001_2007, file = &quot;soc_network2001_2007.RData&quot;)</code></pre>
<pre class="r test"><code>library(stringr)

#empty adjacency matrix for the years 2008-2014
network2008_2014 &lt;- matrix(NA, nrow=nrow(soc_df), ncol=nrow(soc_df))

#select publications of the corresponding time era
pubs_sel &lt;- soc_df_publications %&gt;%
              mutate(author = tolower(author)) %&gt;%
              filter(year&gt;2007 &amp; year&lt;2015)

save(pubs_sel, file = &quot;soc_pubs_sel_2008_2014.RData&quot;)

#fill the matrix
for (ego in 1: nrow(soc_df)) {
  name_ego &lt;- soc_df$last_name[ego] #which ego? 
  pubs_sel2 &lt;- pubs_sel[str_detect(pubs_sel$author, name_ego),] #publications of ego
  for (alter in 1:nrow(soc_df)){
    name_alter &lt;- soc_df$last_name[alter] #which alter? 
    network2008_2014[ego,alter] &lt;- sum(str_detect(pubs_sel2$author, name_alter)) &gt; 1 #did alter publish with ego
  }
}

save(network2008_2014, file = &quot;soc_network2008_2014.RData&quot;)</code></pre>
<pre class="r test"><code>library(stringr)

#empty adjacency matrix for the years 2015-2021
network2015_2021 &lt;- matrix(NA, nrow=nrow(soc_df), ncol=nrow(soc_df))

#select publications of the corresponding time era
pubs_sel &lt;- soc_df_publications %&gt;%
              mutate(author = tolower(author)) %&gt;%
              filter(year&gt;2014 &amp; year&lt;2022)

save(pubs_sel, file = &quot;soc_pubs_sel_2015_2021.RData&quot;)

#fill the matrix
for (ego in 1: nrow(soc_df)) {
  name_ego &lt;- soc_df$last_name[ego] #which ego? 
  pubs_sel2 &lt;- pubs_sel[str_detect(pubs_sel$author, name_ego),] #publications of ego
  for (alter in 1:nrow(soc_df)){
    name_alter &lt;- soc_df$last_name[alter] #which alter? 
    network2015_2021[ego,alter] &lt;- sum(str_detect(pubs_sel2$author, name_alter)) &gt; 1 #did alter publish with ego
  }
}

save(network2015_2021, file = &quot;soc_network2015_2021.RData&quot;)</code></pre>
</div>

<div id="rmd-source-code">LS0tDQp0aXRsZTogIldlYnNjcmFwaW5nIGRhdGEgc29jaW9sb2d5IFJhZGJvdWQgVW5pdmVyc2l0eSINCiNiaWJsaW9ncmFwaHk6IHJlZmVyZW5jZXMuYmliDQphdXRob3I6ICJOaW5hIEJyYW50ZW4iDQotLS0NCg0KYGBge3IsIGVjaG89VFJVRSwgd2FybmluZz1GQUxTRSwgcmVzdWx0cz0naGlkZSd9DQpsaWJyYXJ5KGtuaXRyKQ0KDQprbml0cjo6b3B0c19jaHVuayRzZXQoZWNobyA9IFRSVUUpDQpvcHRzX2NodW5rJHNldCh0aWR5Lm9wdHM9bGlzdCh3aWR0aC5jdXRvZmY9MTAwKSx0aWR5PVRSVUUsIHdhcm5pbmcgPSBGQUxTRSwgbWVzc2FnZSA9IEZBTFNFLGNvbW1lbnQgPSAiIz4iLCBjYWNoZT1UUlVFLCBjbGFzcy5zb3VyY2U9YygidGVzdCIpLCBjbGFzcy5vdXRwdXQ9YygidGVzdDIiKSkNCm9wdGlvbnMod2lkdGggPSAxMDApDQpyZ2w6OnNldHVwS25pdHIoKQ0KDQoNCg0KY29sb3JpemUgPC0gZnVuY3Rpb24oeCwgY29sb3IpIHtzcHJpbnRmKCI8c3BhbiBzdHlsZT0nY29sb3I6ICVzOyc+JXM8L3NwYW4+IiwgY29sb3IsIHgpIH0NCg0KYGBgDQoNCmBgYHtyIGtsaXBweSwgZWNobz1UUlVFLCBpbmNsdWRlPVRSVUV9DQprbGlwcHk6OmtsaXBweShwb3NpdGlvbiA9IGMoJ3RvcCcsICdyaWdodCcpKQ0KI2tsaXBweTo6a2xpcHB5KGNvbG9yID0gJ2RhcmtyZWQnKQ0KI2tsaXBweTo6a2xpcHB5KHRvb2x0aXBfbWVzc2FnZSA9ICdDbGljayB0byBjb3B5JywgdG9vbHRpcF9zdWNjZXNzID0gJ0RvbmUnKQ0KYGBgDQoNCg0KDQpgYGB7cn0NCiNzdGFydCB3aXRoIGNsZWFuIHdvcmtzcGFjZSANCnJtKGxpc3Q9bHMoKSkNCmdldHdkKCkNCmBgYA0KDQojIHBhY2thZ2VzDQpgYGB7cn0NCiNpbnN0YWxsLnBhY2thZ2VzKCJkYXRhLnRhYmxlIikgDQpsaWJyYXJ5KGRhdGEudGFibGUpICMgbWFpbmx5IGZvciBmYXN0ZXIgZGF0YSBoYW5kbGluZw0KbGlicmFyeSh0aWR5dmVyc2UpICMgSSBhc3N1bWUgeW91IGFscmVhZHkgaW5zdGFsbGVkIHRoaXMgb25lIQ0KIyBpbnN0YWxsLnBhY2thZ2VzKCJodHRyIikgIyB3ZSBkb24ndCBuZWVkIHRoaXMgZm9yIG5vdw0KIyByZXF1aXJlKGh0dHIpDQojaW5zdGFsbC5wYWNrYWdlcygieG1sMiIpDQpyZXF1aXJlKHhtbDIpDQojaW5zdGFsbC5wYWNrYWdlcygicnZlc3QiKQ0KcmVxdWlyZShydmVzdCkNCiNpbnN0YWxsLnBhY2thZ2VzKCJkZXZ0b29scyIpDQpyZXF1aXJlKGRldnRvb2xzKQ0KIyBOb3RlIHdlJ3JlIGRvaW5nIHNvbWV0aGluZyBkaWZmZXJlbnQgaGVyZS4gV2UncmUgaW5zdGFsbGluZyBhICpsYXRlc3QqIHZlcnNpb24gZGlyZWN0bHkgZnJvbSBHaXRIdWINCiMgVGhpcyBpcyBiZWNhdXNlIHRoZSByZWxlYXNlZCB2ZXJzaW9uIG9mIHRoaXMgcGFja2FnZXMgY29udGFpbnMgc29tZSBlcnJvcnMhDQojZGV2dG9vbHM6Omluc3RhbGxfZ2l0aHViKCJqa2VpcnN0ZWFkL3NjaG9sYXIiKSANCg0KDQpyZXF1aXJlKHNjaG9sYXIpDQoNCiNkZWZpbmUgd29ya2RpcmVjdG9yeSwgbm90ZSB0aGUgZG91YmxlICpiYWNrc2xhc2hlcyogaWYgeW91J3JlIG9uIHdpbmRvd3MNCiMgc2V0d2QoIi95b3VycGF0aGhlcmUpIg0KYGBgDQoNCiMgc2F2aW5nIHdlYnBhZ2UNCg0KYGBge3IsIGV2YWw9RkFMU0V9DQojIExldCdzIGZpcnN0IGdldCB0aGUgc3RhZmYgcGFnZSByZWFkX2h0bWwgaXMgYSBmdW5jdGlvbiB0aGF0IHNpbXBseSBleHRyYWN0cyBodG1sIHdlYnBhZ2VzIGFuZA0KIyBwdXRzIHRoZW0gaW4geG1sIGZvcm1hdA0Kc29jX3N0YWZmIDwtIHJlYWRfaHRtbCgiaHR0cHM6Ly93d3cucnUubmwvc29jaW9sb2d5L3Jlc2VhcmNoL3N0YWZmLyIpDQoNCiNoZWFkKHNvY19zdGFmZikNCiNjbGFzcyhzb2Nfc3RhZmYpDQpgYGANCg0KIyBtYWtpbmcgZGF0YSB3aXRoIG5hbWVzDQoNCiMjIHNlbGVjdGluZyB0aGUgdGFibGUgd2l0aCBuYW1lcw0KDQpgYGB7ciwgZXZhbD1GQUxTRX0NCnNvY19zdGFmZiA8LSBzb2Nfc3RhZmYgJT4lDQogICAgcnZlc3Q6Omh0bWxfbm9kZXMoImJvZHkiKSAlPiUNCiAgICB4bWwyOjp4bWxfZmluZF9hbGwoIi8vdGQiKSAlPiUNCiAgICBydmVzdDo6aHRtbF90ZXh0KCkNCmBgYA0KDQojIyBzZWxlY3Rpbmcgb25seSB0aGUgb2RkIHJvd2VzIHdpdGggdGhlIG5hbWVzDQpgYGB7ciwgZXZhbD1GQUxTRX0NCmZvZGQgPC0gZnVuY3Rpb24oeCkgew0KICAjd2hhdCBpcyB4LCB4IGlzIGEgdmVjdG9yDQogeCUlMiAhPSAwIA0KfQ0KDQpuc3RhZiA8LSBsZW5ndGgoc29jX3N0YWZmKQ0KDQpzb2NfbmFtZXMgPC0gc29jX3N0YWZmW2ZvZGQoMTpuc3RhZildIA0KaGVhZChzb2NfbmFtZXMpDQoNCmBgYA0KDQojIyBzZWxlY3Rpbmcgb25seSB0aGUgZXZlbiByb3dlcyB3aXRoIHRoZSBleHBlcnRpc2UNCmBgYHtyLCBldmFsPUZBTFNFfQ0Kc29jX2V4cGVydHMgPC0gc29jX3N0YWZmWyFmb2RkKDE6bnN0YWYpXQ0KaGVhZChzb2NfZXhwZXJ0cykNCmBgYA0KDQojIyBjb21iaW5pbmcgbmFtZXMgYW5kIGV4cGVydGlzZSBpbiBzb2NfZGYgDQpgYGB7ciwgZXZhbD1GQUxTRX0NCnNvY19kZiA8LSBkYXRhLmZyYW1lKGNiaW5kKHNvY19uYW1lcywgc29jX2V4cGVydHMpKSANCnNhdmUoc29jX2RmLCBmaWxlID0gIm5hbWVzX2V4cGVydHMuUkRhdGEiKQ0KYGBgDQoNCg0KYGBge3J9DQpsb2FkKCJuYW1lc19leHBlcnRzLlJEYXRhIikNCmBgYA0KDQojIENsZWFuaW5nIHRoZSBkYXRhc2V0ICANCg0KIyMgZGVsZXRlIHJvd3Mgd2l0aG91dCBuYW1lIGluZm8NCmBgYHtyfQ0KIyBpbnNwZWN0IGFnYWluLCBhbmQgcmVtb3ZlIHRoZSByb3dzIHdlIGRvbid0IG5lZWQgKGNoZWNrIGZvciB5b3Vyc2VsZiB0byBiZSBjZXJ0YWluISkNCg0KZGVscm93cyA8LSB3aGljaChzb2NfZGYkc29jX25hbWVzID09ICJTdGFmZjoiIHwgc29jX2RmJHNvY19uYW1lcyA9PSAiUGhEOiIgfCBzb2NfZGYkc29jX25hbWVzID09ICJFeHRlcm5hbCBQaEQ6IiB8DQogICAgc29jX2RmJHNvY19uYW1lcyA9PSAiR3Vlc3QgcmVzZWFyY2hlcnM6IiB8IHNvY19kZiRzb2NfbmFtZXMgPT0gIk90aGVyIHJlc2VhcmNoZXJzOiIpDQoNCnNvY19kZiA8LSBzb2NfZGZbLWRlbHJvd3MsIF0NCmBgYA0KDQojIyBjbGVhbmluZyB0aGUgbmFtZXMgIA0KYGBge3J9DQojIExhc3QgbmFtZSBzZWVtcyB0byBiZSBldmVyeXRoaW5nIGJlZm9yZSB0aGUgY29tbWENCnNvY19kZiRsYXN0X25hbWUgPC0gZ3N1YigiLC4qJCIsICIiLCBzb2NfZGYkc29jX25hbWVzKQ0KDQojIGZpcnN0IG5hbWUgaXMgZXZlcnl0aGluZyBiZXR3ZWVuIGJyYWNrZXRzDQpzb2NfZGYkZmlyc3RfbmFtZSA8LSBhcy5jaGFyYWN0ZXIoc3RyX2V4dHJhY3RfYWxsKHNvY19kZiRzb2NfbmFtZXMsICIoPzw9XFwoKS4rPyg/PVxcKSkiLCBzaW1wbGlmeSA9IFRSVUUpKQ0KYGBgDQoNCmBgYHtyfQ0Kc29jX2RmJGxhc3RfbmFtZSA8LSBnc3ViKCIgSi4gXFwoSmFuc2plXFwpIHZhbiBNU2MiLCAiIiwgc29jX2RmJGxhc3RfbmFtZSkNCnNvY19kZiRmaXJzdF9uYW1lIDwtIHRvbG93ZXIoc29jX2RmJGZpcnN0X25hbWUpICAjIGV2ZXJ5dGhpbmcgdG8gbG93ZXIhDQpzb2NfZGYkbGFzdF9uYW1lIDwtIHRvbG93ZXIoc29jX2RmJGxhc3RfbmFtZSkNCmBgYA0KDQojIyBMb29zZSBkb3VibGUgbmFtZXMNCmBgYHtyfQ0KIyB0cmltd3MgbG9vc2VzIGFsbCBzcGFjaW5nIGJlZm9yZSBhbmQgYWZ0ZXIgKGlmIHlvdSBzcGVjaWZ5ICdib3RoJykgYSBjaGFyYWN0ZXIgc3RyaW5nDQpzb2NfZGYkbGFzdF9uYW1lIDwtIHRyaW13cyhzb2NfZGYkbGFzdF9uYW1lLCB3aGljaCA9IGMoImJvdGgiKSwgd2hpdGVzcGFjZSA9ICJbIFx0XHJcbl0iKQ0Kc29jX2RmJGZpcnN0X25hbWUgPC0gdHJpbXdzKHNvY19kZiRmaXJzdF9uYW1lLCB3aGljaCA9IGMoImJvdGgiKSwgd2hpdGVzcGFjZSA9ICJbIFx0XHJcbl0iKQ0KDQpzb2NfZGYkZmlyc3RfbmFtZSA8LSBhcy5jaGFyYWN0ZXIoc3RyX3NwbGl0KHNvY19kZiRmaXJzdF9uYW1lLCBwYXR0ZXJuPSIgIiwgbiA9IDIsIHNpbXBsaWZ5ID0gVFJVRSlbLDFdKQ0Kc29jX2RmJGZpcnN0X25hbWUgPC0gYXMuY2hhcmFjdGVyKHN0cl9zcGxpdChzb2NfZGYkZmlyc3RfbmFtZSwgcGF0dGVybj0iLSIsIG4gPSAyLCBzaW1wbGlmeSA9IFRSVUUpWywxXSkNCg0KI3JlbW92aW5nIHN0cmFuZ2UgY2hhcmFjdGVycw0Kc29jX2RmJGZpcnN0X25hbWUgPC0gaWNvbnYoc29jX2RmJGZpcnN0X25hbWUsIGZyb20gPSAnVVRGLTgnLCB0byA9ICdBU0NJSS8vVFJBTlNMSVQnKQ0KDQpzb2NfZGYkc29jX2V4cGVydHMgPC0gdHJpbXdzKHNvY19kZiRzb2NfZXhwZXJ0cywgd2hpY2ggPSBjKCJib3RoIiksIHdoaXRlc3BhY2UgPSAiWyBcdFxyXG5dIikNCnNvY19kZiRzb2NfbmFtZXMgPC0gdHJpbXdzKHNvY19kZiRzb2NfbmFtZXMsIHdoaWNoID0gYygiYm90aCIpLCB3aGl0ZXNwYWNlID0gIlsgXHRcclxuXSIpDQpzb2NfZGYkZmlyc3RfbmFtZQ0KYGBgDQpgYGB7cn0NCnNhdmUoc29jX2RmLCBmaWxlPSJzb2NfZGZfczEuUkRhdGEiKQ0KYGBgDQoNCg0KIyBhZGRpbmcgZ2VuZGVyIHRvIGRhdGFzZXQNCg0KIyMgZmdlbmRlcg0KDQpgYGB7ciwgZXZhbD1GQUxTRX0NCmZnZW5kZXIgPC0gZnVuY3Rpb24oc29jX2RmLCBtZSwgZmlsZT1OVUxMKSB7DQoNCiMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIw0KIyBBdXRob3I6IEJhcyBIb2ZzdHJhLCBBbm5lIE1hYWlrZSBNdWxkZXJzLCBKb2NoZW0gVG9sc21hDQojIERBdGU6ICAgMTMtMTAtMjAyMSwgbGFzdCBlZGl0OiAyMi0wOS0yMDIyDQojIFRhc2tzOiAgLSBhc3NpZ24gZ2VuZGVyIGJhZWQgb24gbmFtZQ0KIyAgICAgICAgIC0gQWRhcHRlZCBmcm9tIFJlbnNlIENvcnRlbiBjb2RlIEFwcmlsIDIwMjENCiMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIw0KDQoNCiNJbnB1dDogDQojICAtIGZpcnN0bmFtZV9kZjogYSBkYXRhLmZyYW1lIHdpdGggYSBjb2x1bW4gbmFtZWQgZmlyc3RuYW1lICANCiMgIC0gbWU6IGEgY2hhcmFjdGVyIHZlY3RvciBpbnRyb2R1Y2luZyB5b3Vyc2VsZjogZS5nLiAiSiBUb2xzbWEsIFJhZGJvdWQgVW5pdmVyc2l0eSINCiMgIC0gZmlsZTogbG9jYXRpb24gYW5kIG5hbWUgb2YgZmlsZSB0byBiZSBzYXZlZC4gDQogIA0KIy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQ0KIyBMb2FkIHJlcXVpcmVkIHBhY2thZ2VzDQoNCmlmICghcmVxdWlyZSgidGlkeXZlcnNlIiwgY2hhcmFjdGVyLm9ubHkgPSBUUlVFKSkgew0KICBpbnN0YWxsLnBhY2thZ2VzKCJ0aWR5dmVyc2UiLCBkZXBlbmRlbmNpZXMgPSBUUlVFKQ0KICBsaWJyYXJ5KHRpZHl2ZXJzZSwgY2hhcmFjdGVyLm9ubHkgPSBUUlVFKQ0KfQ0KDQppZiAoIXJlcXVpcmUoInJ2ZXN0IiwgY2hhcmFjdGVyLm9ubHkgPSBUUlVFKSkgew0KICBpbnN0YWxsLnBhY2thZ2VzKCJydmVzdCIsIGRlcGVuZGVuY2llcyA9IFRSVUUpDQogIGxpYnJhcnkocnZlc3QsIGNoYXJhY3Rlci5vbmx5ID0gVFJVRSkNCn0NCg0KaWYgKCFyZXF1aXJlKCJwb2xpdGUiLCBjaGFyYWN0ZXIub25seSA9IFRSVUUpKSB7DQogIGluc3RhbGwucGFja2FnZXMoInBvbGl0ZSIsIGRlcGVuZGVuY2llcyA9IFRSVUUpDQogIGxpYnJhcnkocG9saXRlLCBjaGFyYWN0ZXIub25seSA9IFRSVUUpDQp9DQoNCg0KDQojIG1ha2UgbGlua3MgdG8gc2NyYXBlDQpzb2NfZGYkbmFtZV91cmwgPC0gcGFzdGUwKCJodHRwczovL3d3dy5tZWVydGVucy5rbmF3Lm5sL252Yi9uYWFtL2lzLyIsIHNvY19kZlssIGMoImZpcnN0bmFtZSIpXSkNCg0KDQoNCiMtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0NCiMjIyAyOiBpbnRyb2R1Y2UgdG8gc2VydmVyICMjIw0KDQojIEludHJvZHVjZSBteXNlbGYgdG8gdGhlIHNlcnZlcg0Kc2Vzc2lvbiA8LSBib3coImh0dHBzOi8vd3d3Lm1lZXJ0ZW5zLmtuYXcubmwvbnZiL25hYW0vaXMiLCB1c2VyX2FnZW50ID0gbWUgLCBkZWxheSA9IDEpDQoNCg0KIy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQ0KIyMjIDM6IG1ha2UgZnVuY3Rpb24gdG8gZ2V0IHRhYmxlIGZyb20gIyMjDQogIGZuYW1lcyA8LSBmdW5jdGlvbihsaW5rKXsgDQogICAgbmFtZV9zZXNzaW9uIDwtbm9kKHNlc3Npb24sIHBhdGggPSBsaW5rKQ0KICAgIG5hbWVfcGFnZSA8LSBzY3JhcGUobmFtZV9zZXNzaW9uKSANCiAgICByZXR1cm4obmFtZV9wYWdlKQ0KICB9DQogIA0KbmFtZV9saXN0IDwtIGxpc3QoKQ0KdGFibGVfbGlzdCA8LSBsaXN0KCkNCnNvY19kZiRnZW5kZXIgPC0gTkENCg0KICBmb3IgKGkgaW4gMTpucm93KHNvY19kZikpIHsNCiAgICBwcmludChpKQ0KICAgIG5hbWVfbGlzdFtbaV1dIDwtIGZuYW1lcyhzb2NfZGZbaSwgYygibmFtZV91cmwiKV0pDQogICAgIyBleHRyYWN0IG5hbWUgZnJlcXVlbmN5IHRhYmxlIGFuZCBnZW5kZXIgaW5mbw0KICAgIHRhYmxlX2xpc3RbW2ldXSA8LSBuYW1lX2xpc3RbW2ldXSAlPiUgaHRtbF90YWJsZSgpDQogICAgDQogICAgdGFibGVfbGlzdFtbaV1dW1sxXV1bdGFibGVfbGlzdFtbaV1dW1sxXV09PSItLSJdIDwtICIwIg0KICAgIA0KICAgIGlmIChhcy5udW1lcmljKHRhYmxlX2xpc3RbW2ldXVtbMV1dJFgzWzJdKSA+IGFzLm51bWVyaWModGFibGVfbGlzdFtbaV1dW1sxXV0kWDNbNl0pKSB7DQogICAgICBzb2NfZGYkZ2VuZGVyW2ldIDwtICJtYWxlIiB9IGVsc2Ugew0KICAgICAgICBzb2NfZGYkZ2VuZGVyW2ldIDwtICJmZW1hbGUiDQogICAgICB9DQogICAgDQogICAgaWYgKCFpcy5udWxsKGZpbGUpKSAoc2F2ZShzb2NfZGYsIGZpbGU9ZmlsZSkpDQogICAgDQogICAgfQ0KICByZXR1cm4oc29jX2RmKQ0KfQ0KYGBgDQoNCiMjIGdlbmRlciB0byBzb2NfZGYNCmBgYHtyLCBldmFsPUZBTFNFfQ0Kc29jX2RmICU+JSBtdXRhdGUoZmlyc3RuYW1lPWZpcnN0X25hbWUpIC0+IHNvY19kZg0KDQpzb2NfZGYkZmlyc3RuYW1lDQpzb2NfZGYgPC0gZmdlbmRlcihzb2NfZGYsIG1lPSJKb2NoZW0gVG9sc21hLCBSVS9SVUciKQ0KYGBgDQoNCg0KYGBge3IsIGV2YWw9RkFMU0V9DQpzYXZlKHNvY19kZiwgZmlsZT0ic29jX2RmX3MyLlJEYXRhIikNCmBgYA0KDQpgYGB7cn0NCmxvYWQoInNvY19kZl9zMi5SRGF0YSIpDQpgYGANCg0KDQojIyBhZmZpbGlhdGlvbg0KYGBge3J9DQojIHNldCBhZmZpbGlhdGlvbiB0byByYWRib3VkLCBjb21lcyBpbiBoYW5keSBmb3IgcXVlcnlpbmcgZ29vZ2xlIHNjaG9sYXINCnNvY19kZiRhZmZpbGlhdGlvbiA8LSAicmFkYm91ZCB1bml2ZXJzaXR5Ig0KYGBgDQoNCiMgaGFydmVzdGluZyBkYXRhIGZyb20gZ29vZ2xlIHNjaG9sYXINCg0KYGBge3IsIGV2YWw9RkFMU0V9DQojcmVxdWlyZShzY2hvbGFyKQ0KDQpnZXRfc2Nob2xhcl9pZF9maXggPC0gZnVuY3Rpb24gKGxhc3RfbmFtZSA9ICIiLCBmaXJzdF9uYW1lID0gIiIsIGFmZmlsaWF0aW9uID0gTkEpDQp7DQogIGlmICghYW55KG56Y2hhcihjKGZpcnN0X25hbWUsIGxhc3RfbmFtZSkpKSkNCiAgICBzdG9wKCJBdCBsZWFzdCBvbmUgb2YgZmlyc3QgYW5kIGxhc3QgbmFtZSBtdXN0IGJlIHNwZWNpZmllZCEiKQ0KICBzaXRlIDwtIGdldE9wdGlvbigic2Nob2xhcl9zaXRlIikNCiAgdXJsIDwtIHBhc3RlMChzaXRlLCAiL2NpdGF0aW9ucz92aWV3X29wPXNlYXJjaF9hdXRob3JzJm1hdXRob3JzPSIsDQogICAgICAgICAgICAgICAgZmlyc3RfbmFtZSwgIisiLCBsYXN0X25hbWUsICImaGw9ZW4mb2k9YW8iKQ0KICBwYWdlIDwtIGdldF9zY2hvbGFyX3Jlc3AodXJsKQ0KICBpZiAoaXMubnVsbChwYWdlKSkNCiAgICByZXR1cm4oTkEpDQogIGFhIDwtIGh0dHI6OmNvbnRlbnQocGFnZSwgYXMgPSAidGV4dCIpDQogICMgYWRkZWQgYnkgQmFzIEhvZnN0cmE6IGJ1Z2ZpeCBmb3IgSURzIHRoYXQgaGF2ZSBhIGRhc2ggKCItIikNCiAgaWRzIDwtIHN1YnN0cmluZyhhYSwgcmVnZXhwcigiO3VzZXI9IiwgYWEpKQ0KICBpZHMgPC0gc3Vic3RyKGlkcywgMSwgMTkpICMgZXJyb3IgcHJvbmUsIGJ1dCB1bnN1cmUgaG93IHRvIHNvbHZlIG90aGVyd2lzZQ0KICAjIGlmIChuY2hhcihzdHJpbmdyOjpzdHJfZXh0cmFjdF9hbGwoc3RyaW5nID0gYWEsIHBhdHRlcm4gPSAiO3VzZXI9W1s6YWxudW06XV0rW1s6cHVuY3Q6XV0iKVtbMV1dWzFdKSA8IDE4KSB7DQogICMgICBpZHMgPC0gc3RyaW5ncjo6c3RyX2V4dHJhY3RfYWxsKHN0cmluZyA9IGFhLCBwYXR0ZXJuID0gIjt1c2VyPVtbOmFsbnVtOl1dK1tbOnB1bmN0Ol1dK1tbOmFsbnVtOl1dK1tbOnB1bmN0Ol1dIikNCiAgIyB9IGVsc2Ugew0KICAjICAgaWRzIDwtIHN0cmluZ3I6OnN0cl9leHRyYWN0X2FsbChzdHJpbmcgPSBhYSwgcGF0dGVybiA9ICI7dXNlcj1bWzphbG51bTpdXStbWzpwdW5jdDpdXSIpDQogICMgfQ0KICBpZiAobGVuZ3RoKHVubGlzdChpZHMpKSA9PSAwKSB7DQogICAgbWVzc2FnZSgiTm8gU2Nob2xhciBJRCBmb3VuZC4iKQ0KICAgIHJldHVybihOQSkNCiAgfQ0KICBpZHMgPC0gaWRzICU+JSB1bmxpc3QgJT4lIGdzdWIoIjt1c2VyPXxbWzpwdW5jdDpdXSQiLCAiIiwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC4pICU+JSB1bmlxdWUNCiAgaWYgKGxlbmd0aChpZHMpID4gMSkgew0KICAgIHByb2ZpbGVzIDwtIGxhcHBseShpZHMsIHNjaG9sYXI6OmdldF9wcm9maWxlKQ0KICAgIGlmIChpcy5uYShhZmZpbGlhdGlvbikpIHsNCiAgICAgIHhfcHJvZmlsZSA8LSBwcm9maWxlc1tbMV1dDQogICAgICB3YXJuaW5nKCJTZWxlY3RpbmcgZmlyc3Qgb3V0IG9mICIsIGxlbmd0aChwcm9maWxlcyksDQogICAgICAgICAgICAgICIgY2FuZGlkYXRlIG1hdGNoZXMuIikNCiAgICB9DQogICAgZWxzZSB7DQogICAgICB3aGljaF9wcm9maWxlIDwtIHNhcHBseShwcm9maWxlcywgZnVuY3Rpb24oeCkgew0KICAgICAgICBzdHJpbmdyOjpzdHJfY291bnQoc3RyaW5nID0geCRhZmZpbGlhdGlvbiwgcGF0dGVybiA9IHN0cmluZ3I6OmNvbGwoYWZmaWxpYXRpb24sDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZ25vcmVfY2FzZSA9IFRSVUUpKQ0KICAgICAgfSkNCiAgICAgIGlmIChhbGwod2hpY2hfcHJvZmlsZSA9PSAwKSkgew0KICAgICAgICB3YXJuaW5nKCJObyByZXNlYXJjaGVyIGZvdW5kIGF0IHRoZSBpbmRpY2F0ZWQgYWZmaWxpYXRpb24uIikNCiAgICAgICAgcmV0dXJuKE5BKQ0KICAgICAgfQ0KICAgICAgZWxzZSB7DQogICAgICAgIHhfcHJvZmlsZSA8LSBwcm9maWxlc1tbd2hpY2god2hpY2hfcHJvZmlsZSAhPQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgMCldXQ0KICAgICAgfQ0KICAgIH0NCiAgfQ0KICBlbHNlIHsNCiAgICB4X3Byb2ZpbGUgPC0gc2Nob2xhcjo6Z2V0X3Byb2ZpbGUoaWQgPSBpZHMpDQogIH0NCiAgcmV0dXJuKHhfcHJvZmlsZSRpZCkNCn0NCmBgYA0KDQojIyBzY2hvbGFycyBpZC4gDQoNClJlbW92ZSBzdGFmZiBtZW1iZXJzIHdpdGhvdXQgc2Nob2xhciBpZHMuIA0KDQpgYGB7ciwgZXZhbD1GQUxTRX0NCg0Kc29jX2RmJGdzX2lkIDwtICIiDQoNCmZvciAoaSBpbiAxOm5yb3coc29jX2RmKSkgew0KICBwcmludChpKQ0KICB0aW1lIDwtIHJ1bmlmKDEsIDAsIDEpDQogIFN5cy5zbGVlcCh0aW1lKQ0KDQogIHRyeUNhdGNoKHsNCiAgICAgc29jX2RmW2ksYygiZ3NfaWQiKV0gPC0gZ2V0X3NjaG9sYXJfaWRfZml4KGxhc3RfbmFtZSA9IHNvY19kZltpLCBjKCJsYXN0X25hbWUiKV0sICMgc28gc2VhcmNoIG9uIGxhc3RfbmFtZSBvZiBzdGFmZiAodGhpcmQgY29sdW1uKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZmlyc3RfbmFtZSA9IHNvY19kZltpLCBjKCJmaXJzdF9uYW1lIildLCAgIyBzZWFyY2ggb24gZmlyc3RfbmFtZSBvZiBzdGFmZiAoZm91cnRoIGNvbHVtbikNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFmZmlsaWF0aW9uID0gc29jX2RmW2ksYygiYWZmaWxpYXRpb24iKV0pICMgc2VhcmNoIG9uIGFmZmlsaWF0aW9uIG9mIGVhY2ggc3RhZmYgKGZpZnRoIGNvbHVtbikNCg0KICAgIH0sIGVycm9yPWZ1bmN0aW9uKGUpe2NhdCgiRVJST1IgOiIsIGNvbmRpdGlvbk1lc3NhZ2UoZSksICJcbiIpfSkgIyBjb250aW51ZSBvbiBlcnJvciwgYnV0IHByaW50IHRoZSBlcnJvcg0KICB9DQoNCiMgcmVtb3ZlIHRob3NlIHdpdGhvdXQgcHVicyBmcm9tIHRoZSBkZg0KIyBzZWVtcyB3ZSdyZSBsZWZ0IHdpdGggYWJvdXQgMzQgc29jaW9sb2d5IHN0YWZmIG1lbWJlcnMhDQpzb2NfZGZfY29weSA8LSBzb2NfZGYgI2p1c3QgdG8gYWxzbyBoYXZlIHRoZSBkYXRhIHdpdGggc3RhZmYgd2l0aG91dCBzY2hvbGFyX2lkDQpzb2NfZGYgPC0gc29jX2RmWyFzb2NfZGYkZ3NfaWQgPT0gIiIsIF0NCg0KYGBgDQoNCg0KYGBge3IsIGV2YWw9RkFMU0V9DQpzYXZlKHNvY19kZiwgZmlsZT0ic29jX2RmX3MzLlJEYXRhIikNCnNhdmUoc29jX2RmX2NvcHksIGZpbGU9InNvY19kZl9jb3B5LlJEYXRhIikNCg0KYGBgDQoNCmBgYHtyfQ0KbG9hZCgic29jX2RmX3MzLlJEYXRhIikNCmBgYA0KDQoNCiMgcHVibGljYXRpb25zIGFuZCBwcm9maWxlcw0KDQpXZSBzYXZlIHRoZSBwdWJsaWNhdGlvbnMgYW5kIGluZm8gb2YgdGhlIHNjaG9sYXIgcHJvZmlsZXMgaW4gbmV3IG9iamVjdHMuIA0KDQoNCmBgYHtyLCBldmFsPUZBTFNFfQ0Kc29jX2xpc3RfcHJvZmlsZXMgPC0gbGlzdCgpICAjIGZpcnN0IHdlIGNyZWF0ZSBhbiBlbXB0eSBsaXN0IHRoYXQgd2UgdGhlbiBmaWxsIHVwIHdpdGggdGhlIGZvciBsb29wDQpzb2NfbGlzdF9wdWJsaWNhdGlvbnMgPC0gbGlzdCgpDQoNCnRpbWUgPC0gMSAjIEkgcGxhY2VkIHRoZSB3YWl0aW5nIHRpbWUgb3V0c2lkZSB0aGUgbG9vcA0KaSA8LSAxICMgT3VyIGxvb3AgaXRlcmF0b3IgaXMgbm93IGEgdmFyaWFibGUuIFRoaXMgbWVhbnMgSSBjYW4gY2hhbmdlIGl0IHdpdGhpbiBhIHdoaWxlIGxvb3AuIFVzaW5nIGEgZm9yIGxvb3AgeW91IGNhbnQgY2hhbmdlIHlvdXIgaXRlcmF0b3IgaW4gdGhlIGxvb3AgaXRzZWxmLiANCg0Kd2hpbGUgKGkgPD0gbnJvdyhzb2NfZGYpKSB7DQogICAgcHJpbnQoaSkNCiAgICBTeXMuc2xlZXAodGltZSkNCg0KICAgDQogICAgdHJ5Q2F0Y2goew0KICAgICNJbiB0aGlzIHBhcnQgb2YgdGhlIHRyeUNhdGNoIGZ1bmN0aW9uIHlvdSBwdXQgYWxsIHRoZSBzdHVmZiB5b3Ugd2FudCB0byBkbyBpbiB0aGUgbG9vcC4NCiAgICAjIG5vdGUgaG93IHlvdSBjYWxsIGRpZmZlcmVudCBlbGVtZW50cyBpbiBhIGxpc3QgJ1tbXV0nLCBmaWxsIGluIHRoZSBpLXRoIGVsZW1lbnQNCiAgICBzb2NfbGlzdF9wcm9maWxlc1tbaV1dIDwtIGdldF9wcm9maWxlKHNvY19kZltpLCBjKCJnc19pZCIpXSkgICMgTm90ZSBob3cgd2UgY2FsbCByb3cgaSAocmVtZW1iZXIgaG93IHRvIGNhbGwgcm93cyBpbiBhIERGL01hdHJpeCkgYW5kIHRoZW4gdGhlIGFzc29jaWF0ZWQgc2Nob2xhciBpZA0KICAgIHNvY19saXN0X3B1YmxpY2F0aW9uc1tbaV1dIDwtIGdldF9wdWJsaWNhdGlvbnMoc29jX2RmW2ksIGMoImdzX2lkIildKQ0KICAgIHNvY19saXN0X3B1YmxpY2F0aW9uc1tbaV1dWywgYygiZ3NfaWQiKV0gPC0gc29jX2RmW2ksIGMoImdzX2lkIildICAjIG5vdGUgdGhhdCB3ZSBhZ2FpbiBhdHRhY2ggYW4gaWQNCiAgICAjIHNvIGJvdGggZnVuY3Rpb25zIGhlcmUgY2FsbCB0aGUgZW50aXJlIHByb2ZpbGUgYW5kIHB1YnMgZm9yIGFuIGF1dGhvciwgYmFzZWQgb24gZ29vZ2xlDQogICAgIyBzY2hvbGFyIGlkcw0KICAgIGkgPC0gaSArIDEgI0lNUE9SVEFOVCwgWU9VIE5FRUQgVE8gVEVMTCBUSEUgV0hJTEUgTE9PUCBUSEFUIFlPVVIgSVRFUkFUT1IgSEFTIFRPIEJFIElOQ1JFQVNFRA0KICAgIH0sDQogICAgICB3YXJuaW5nID0gZnVuY3Rpb24odykgew0KICAgICAgICBjYXQoIldBUk5JTkc6IiwgY29uZGl0aW9uTWVzc2FnZSh3KSwgIlxuIikgI1dBUk5JTkcgbWVzc2FnZQ0KICAgICAgICBpIDw8LSBpICsgMX0sICNCVVQgV0UgRE8gV0FOVCBUTyBDT05USU5VRS4gTk9URSBUSEUgRE9VQkxFIDw8IFRISVMgSVMgQkVDQVVTRSBJIFdBTlQgVE8gQ0hBTkdFIEEgVkFSSUFCTEUgV0hJQ0ggRVhJU1RTIE9VVFNJREUgVEhFIFdBUk5JTkcgRlVOQ1RJT04NCiAgICAgIGVycm9yID1mdW5jdGlvbihlKSB7DQogICAgICAgIHRpbWUgPDwtIG1pbih0aW1lICoxMCwgMzYwMCoyKQ0KICAgICAgICBjYXQoIkVycm9yOiIsIGNvbmRpdGlvbk1lc3NhZ2UoZSksICJcbiIpICNFUlJPUiBtZXNzYWdlDQogICAgICAgIGNhdCgic2xlZXAgdGltZToiLCB0aW1lLCAgIlxuIikNCiAgICAgICAgY2F0KCJpayB6aXQgaW4gbG9vcCIsIGkpDQogICAgICAgICNBRlRFUiBUSEUgTkVXIFNMRUVQIFRJTUUsIFdFIFRSWSBBR0FJTiwgV0UgVEhFUkVGT1JFIERPIE5PVCBVUERBVEUgaS4gaWRlYWxseSB5b3UgYWxzbyB3YW50IHRvIGhhdmUgc29tZSBicmVhayBvcHRpb24uIEFuZCBtYXliZSB5b3UgYWxzbyB3YW50IHRvIHNhdmUgeW91ciBkYXRhIHdoZW4geW91IGhpdCBhIHRpbWUgb3V0IGVycm9yLiANCiAgICAgIH0pDQogICANCiANCn0NCmBgYA0KDQoNCmBgYHtyLCBldmFsPUZBTFNFfQ0KIyBUaGUgMzYgUlUgc29jaW9sb2d5IHNjaG9sYXJzIHB1Ymxpc2ggfjMwMDAgcGFwZXJzDQpzb2NfZGZfcHVibGljYXRpb25zIDwtIGJpbmRfcm93cyhzb2NfbGlzdF9wdWJsaWNhdGlvbnMpDQpgYGANCg0KDQpgYGB7ciwgZXZhbD1GQUxTRX0NCnNhdmUoc29jX2RmX3B1YmxpY2F0aW9ucywgZmlsZT0ic29jX2RmX3B1YmxpY2F0aW9ucy5SRGF0YSIpDQpzYXZlKHNvY19saXN0X3Byb2ZpbGVzLCBmaWxlPSAic29jX2xpc3RfcHJvZmlsZXMuUkRhdGEiKQ0KYGBgDQoNCmBgYHtyfQ0KbG9hZCgic29jX2RmX3B1YmxpY2F0aW9ucy5SRGF0YSIpDQpsb2FkKCJzb2NfbGlzdF9wcm9maWxlcy5SRGF0YSIpDQpgYGANCg0KDQojIyBwdXQgdGhlIGluZm8gb2YgdGhlIHByb2ZpbGVzIGluIG91ciBkYXRhIHNldCBvZiBzdGFmZiBtZW1iZXJzIHNvY19kZg0KDQpgYGB7ciwgZXZhbD1GQUxTRX0NCnNvY19wcm9maWxlc19kZiA8LSBsaXN0KCkNCg0KDQpmb3IgKGkgaW4gMTpsZW5ndGgoc29jX2xpc3RfcHJvZmlsZXMpKSB7DQogICAgIyBzb2NfcHJvZmlsZXNfZGZbW2ldXSA8LSBkYXRhLmZyYW1lKHQodW5saXN0KHNvY19saXN0X3Byb2ZpbGVzW1tpXV1bMTo4XSkpKSAjc29tZSBhbm55b2luZw0KICAgICMgZGF0YSBoYW5kbGluZw0KICBpZiAoIWlzLm51bGwoc29jX2xpc3RfcHJvZmlsZXNbW2ldXSkpIHsNCiAgICBzb2NfcHJvZmlsZXNfZGZbW2ldXSA8LSB1bmxpc3Qoc29jX2xpc3RfcHJvZmlsZXNbW2ldXVsxOjhdKQ0KICAgIHNvY19wcm9maWxlc19kZltbaV1dIDwtIGRhdGEuZnJhbWUoc29jX3Byb2ZpbGVzX2RmW1tpXV0pDQogICAgc29jX3Byb2ZpbGVzX2RmW1tpXV0gPC0gdChzb2NfcHJvZmlsZXNfZGZbW2ldXSkNCiAgICByb3cubmFtZXMoc29jX3Byb2ZpbGVzX2RmW1tpXV0pIDwtIE5VTEwNCiAgICBzb2NfcHJvZmlsZXNfZGZbW2ldXSA8LSBkYXRhLmZyYW1lKHNvY19wcm9maWxlc19kZltbaV1dKQ0KICB9DQp9DQoNCiNzb2NfcHJvZmlsZXNfZGYNCg0Kc29jX3Byb2ZpbGVzX2RmMiA8LSBiaW5kX3Jvd3Moc29jX3Byb2ZpbGVzX2RmKQ0Kc29jX2RmIDwtIGxlZnRfam9pbihzb2NfZGYsIHNvY19wcm9maWxlc19kZjIsIGJ5ID0gYyhnc19pZCA9ICJpZCIpKSAgIyBtZXJnZSBkYXRhIHdpdGggc29jX2RmDQpzb2NfZGYgICMgbm90aWNlIGFsbCB0aGUgbmV3IGluZm9ybWF0aW9uIHdlIHdlcmUgYWJsZSB0byBnZXQgZnJvbSB0aGUgc2Nob2xhciBwcm9maWxlcyENCg0KYGBgDQoNCg0KYGBge3IsIGV2YWw9RkFMU0V9DQpzYXZlKHNvY19kZiwgZmlsZT0ic29jX2RmX3M0LlJEYXRhIikNCg0KYGBgDQoNCmBgYHtyfQ0KbG9hZCgic29jX2RmX3M0LlJEYXRhIikNCmBgYA0KDQoNCiMgY2l0YXRpb24gaGlzdG9yeQ0KDQpgYGB7ciwgZXZhbD1GQUxTRX0NCiMgZ2V0IGNpdGF0aW9uIGhpc3Rvcnkgb2YgYSBzY2hvbGFyDQpzb2Nfc3RhZmZfY2l0IDwtIGxpc3QoKQ0KDQoNCnRpbWUgPC0gMSAjIEkgcGxhY2VkIHRoZSB3YWl0aW5nIHRpbWUgb3V0c2lkZSB0aGUgbG9vcA0KaSA8LSAxICMgT3VyIGxvb3AgaXRlcmF0b3IgaXMgbm93IGEgdmFyaWFibGUuIFRoaXMgbWVhbnMgSSBjYW4gY2hhbmdlIGl0IHdpdGhpbiBhIHdoaWxlIGxvb3AuIFVzaW5nIGEgZm9yIGxvb3AgeW91IGNhbnQgY2hhbmdlIHlvdXIgaXRlcmF0b3IgaW4gdGhlIGxvb3AgaXRzZWxmLiANCg0Kd2hpbGUgKGkgPD0gbnJvdyhzb2NfZGYpKSB7DQogICAgcHJpbnQoaSkNCiAgICBTeXMuc2xlZXAodGltZSkNCg0KICAgIHRyeUNhdGNoKHsNCiAgICAgIHNvY19zdGFmZl9jaXRbW2ldXSA8LSBnZXRfY2l0YXRpb25faGlzdG9yeShzb2NfZGZbaSwgYygiZ3NfaWQiKV0pDQogICAgICAgIGlmIChucm93KHNvY19zdGFmZl9jaXRbW2ldXSkgPiAwKSB7DQogICAgICAgICAgc29jX3N0YWZmX2NpdFtbaV1dWywgYygiZ3NfaWQiKV0gPC0gc29jX2RmW2ksIGMoImdzX2lkIildICAjIGFnYWluIGF0dGFjaCB0aGUgZ3NfaWQgYXMgdGhpcmQgY29sdW1uDQogICAgICAgIH0NCiAgICBpIDwtIGkgKyAxDQogICAgfSwNCiAgICAgIHdhcm5pbmcgPSBmdW5jdGlvbih3KSB7DQogICAgICAgIGNhdCgiV0FSTklORzoiLCBjb25kaXRpb25NZXNzYWdlKHcpLCAiXG4iKSAjV0FSTklORyBtZXNzYWdlDQogICAgICAgIGkgPDwtIGkgKyAxfSwgI0JVVCBXRSBETyBXQU5UIFRPIENPTlRJTlVFLiBOT1RFIFRIRSBET1VCTEUgPDwgVEhJUyBJUyBCRUNBVVNFIEkgV0FOVCBUTyBDSEFOR0UgQSBWQVJJQUJMRSBXSElDSCBFWElTVFMgT1VUU0lERSBUSEUgV0FSTklORyBGVU5DVElPTg0KICAgICAgZXJyb3IgPWZ1bmN0aW9uKGUpIHsNCiAgICAgICAgdGltZSA8PC0gbWluKHRpbWUgKjEwLCAzNjAwKjIpDQogICAgICAgIGNhdCgiRXJyb3I6IiwgY29uZGl0aW9uTWVzc2FnZShlKSwgIlxuIikgI0VSUk9SIG1lc3NhZ2UNCiAgICAgICAgY2F0KCJzbGVlcCB0aW1lOiIsIHRpbWUsICAiXG4iKQ0KICAgICAgICBjYXQoImlrIHppdCBpbiBsb29wIiwgaSkNCiAgICAgICAgI0FGVEVSIFRIRSBORVcgU0xFRVAgVElNRSwgV0UgVFJZIEFHQUlOLCBXRSBUSEVSRUZPUkUgRE8gTk9UIFVQREFURSBpLiBpZGVhbGx5IHlvdSBhbHNvIHdhbnQgdG8gaGF2ZSBzb21lIGJyZWFrIG9wdGlvbi4gQW5kIG1heWJlIHlvdSBhbHNvIHdhbnQgdG8gc2F2ZSB5b3VyIGRhdGEgd2hlbiB5b3UgaGl0IGEgdGltZSBvdXQgZXJyb3IuIA0KICAgICAgfSkNCg0KICAgIA0KfQ0Kc29jX3N0YWZmX2NpdCA8LSBiaW5kX3Jvd3Moc29jX3N0YWZmX2NpdCkNCmBgYA0KDQoNCmBgYHtyLCBldmFsPUZBTFNFfQ0Kc2F2ZShzb2Nfc3RhZmZfY2l0LCBmaWxlPSJzb2Nfc3RhZmZfY2l0LlJEYXRhIikNCg0KYGBgDQoNCmBgYHtyfQ0KbG9hZCgic29jX3N0YWZmX2NpdC5SRGF0YSIpDQpgYGANCg0KDQojIGNvbGxhYm9yYXRvcnMNCmBgYHtyLCBldmFsPUZBTFNFfQ0KcmVxdWlyZShydmVzdCkNCnJlcXVpcmUoeG1sMikNCnJlcXVpcmUodGlkeXZlcnNlKQ0KDQojIGZ1bmN0aW9uIHRvIGdldCBjb2xsYWJvcmF0b3JzIGFuZCBuYW1lcyBmcm9tIEdTIHByb2ZpbGVzDQpmY29sbGFicyA8LSBmdW5jdGlvbihnc2lkLCBsb29rZm9yY29sbGFicykgew0KDQogIGh0bWxwYWdlMSA8LSByZWFkX2h0bWwocGFzdGUwKCJodHRwczovL3NjaG9sYXIuZ29vZ2xlLm5sL2NpdGF0aW9ucz91c2VyPSIsIGdzaWQsICImaGw9ZW4iKSkgIyBzbyB3ZSBwYXN0ZSB0aGUgZ29vZ2xlIHNjaG9sYXIgaWQNCiAgcHJvZmlsZW5hbWUgPC0gaHRtbHBhZ2UxICU+JSBodG1sX25vZGVzKHhwYXRoID0gIi8vKi9kaXZbQGlkPSdnc2NfcHJmX2luJ10iKSAlPiUgaHRtbF90ZXh0KCkgIyB3ZSBleHRyYWN0IHRoZSBwcm9maWxlIG5hbWUgb2YgdGhhdCBnb29nbGUgc2Nob2xhciBwYWdlDQogIHByb2ZpbGVjb2xsYWJzMSA8LSBhcy5kYXRhLmZyYW1lKDApICMgZW1wdHkgZGYgbmVjZXNzYXJ5IGZvciBsYXRlcg0KICBwcm9maWxlY29sbGFiczIgPC0gYXMuZGF0YS5mcmFtZSgwKSAjIGVtcHR5IGRmIG5lY2Vzc2FyeSBmb3IgbGF0ZXINCg0KICBpZiAobG9va2ZvcmNvbGxhYnMgPT0gMSkgeyAjIHNvIGlmIHlvdSB3YW50IHRvIGxvb2sgZm9yIGNvbGxhYnMsIHNldCBmdW5jdGlvbiB0byAxDQoNCiAgICBodG1scGFnZTIgPC0gcmVhZF9odG1sKHBhc3RlMCgiaHR0cHM6Ly9zY2hvbGFyLmdvb2dsZS5jb20vY2l0YXRpb25zP3ZpZXdfb3A9bGlzdF9jb2xsZWFndWVzJmhsPWVuJnVzZXI9IiwgZ3NpZCkpICMgc28gd2UgcGFzdGUgdGhlIGdvb2dsZSBzY2hvbGFyIGlkDQogICAgcHJvZmlsZWNvbGxhYnMxIDwtICBodG1scGFnZTIgJT4lIGh0bWxfbm9kZXMoY3NzPSJoMyIpICU+JSBodG1sX3RleHQoKSAjIGdldCBuYW1lcw0KICAgIHByb2ZpbGVjb2xsYWJzMSA8LSAgYXMuZGF0YS5mcmFtZShwcm9maWxlY29sbGFiczEpDQoNCiAgICBwcm9maWxlY29sbGFiczIgPC0gaHRtbHBhZ2UyICU+JSBodG1sX25vZGVzKCJhIikgJT4lIGh0bWxfYXR0cigiaHJlZiIpICMgZ2V0IHRoZSBsaW5rDQogICAgcHJvZmlsZWNvbGxhYnMyIDwtIHByb2ZpbGVjb2xsYWJzMltzZXFfYWxvbmcocHJvZmlsZWNvbGxhYnMyKSAlJSAyID4gMF0NCiAgICBwcm9maWxlY29sbGFiczIgPC0gc3Vic3RyaW5nKHByb2ZpbGVjb2xsYWJzMiwgMjMpDQoNCiAgfQ0KICBpZiAobnJvdyhwcm9maWxlY29sbGFiczEpPjEpIHsgIyBpZiB0aGVyZSBBUkUgY29sbGFicw0KDQogICAgcHJvZmlsZWNvbGxhYnMxIDwtIGFzLmRhdGEuZnJhbWUocHJvZmlsZWNvbGxhYnMxKSAjIHdlIHdhbnQgdG8uLi4NCiAgICBwcm9maWxlY29sbGFiczIgPC0gIGFzLmRhdGEuZnJhbWUocHJvZmlsZWNvbGxhYnMyKQ0KICAgIHByb2ZpbGVjb2xsYWJzMVssYygiY29hdXRoX2lkIildIDwtIHByb2ZpbGVjb2xsYWJzMlssMV0NCg0KICAgIHByb2ZpbGVjb2xsYWJzMVssYygiZ3NfaWQiKV0gPC0gZ3NpZCAjLi4uIGFkZCBnc19pZHMgb2YgZm9jYWwgR1MgcHJvZmlsZQ0KICAgIHByb2ZpbGVjb2xsYWJzMVssYygibmFtZSIpXSA8LSBwcm9maWxlbmFtZSAjLi4uYW5kIHRoZSB0aGUgcHJvZmlsZSBuYW1lIG9mIEdTIHByb2ZpbGUgYXR0YWNoZWQNCg0KICAgIG5hbWVzKHByb2ZpbGVjb2xsYWJzMSlbMV0gPC0gImNvYXV0aCINCg0KICB9IGVsc2Ugew0KICAgIHByb2ZpbGVjb2xsYWJzMSA8LSBhcy5kYXRhLmZyYW1lKGNiaW5kKGdzaWQsIHByb2ZpbGVuYW1lKSkgIyBpZiBOT1QgbG9va2luZyBmb3IgY29sbGFicy4uLg0KICAgIG5hbWVzKHByb2ZpbGVjb2xsYWJzMSkgPC0gYygiZ3NfaWQiLCAibmFtZSIpICMuLi53ZSBvbmx5IGF0dGFjaCBnc19pZCBhbmQgcHJvZmlsZW5hbWUNCg0KICB9DQogIHJldHVybihwcm9maWxlY29sbGFiczEpDQoNCn0NCmBgYA0KDQpgYGB7ciwgZXZhbD1GQUxTRX0NCiMgaW5wdXQgYSBnb29nbGUgc2Nob2xhciBpZCBhbmQgYSAxIChpZiB5b3Ugd2FudCB0byBmaW5kIGNvbGxhYnMpIG9yIDAgKG9ubHkgZXh0cmFjdGluZyBuYW1lcykNCg0Kc29jX2NvbGxhYnMgPC0gbGlzdCgpDQpmb3IgKGkgaW4gMTpucm93KHNvY19kZikpIHsNCiAgICBwcmludChpKQ0KICAgIHRpbWUgPC0gcnVuaWYoMSwgMCwgMSkNCiAgICBTeXMuc2xlZXAodGltZSkNCg0KICAgIHNvY19jb2xsYWJzW1tpXV0gPC0gZmNvbGxhYnMoc29jX2RmW2ksIGMoImdzX2lkIildLCAxKQ0KDQp9DQoNCnNvY19jb2xsYWJzIDwtIGJpbmRfcm93cyhzb2NfY29sbGFicykgICMgYmluZCByb3dzLCBnZXQgdGhlIHVuaXF1ZSBvbmVzIQ0Kc29jX2NvbGxhYnNfdW5pcXVlIDwtIHVuaXF1ZShzb2NfY29sbGFic1ssIDNdKSANCnNvY19jb2xsYWJzX3VuaXF1ZSA8LSBzb2NfY29sbGFic191bmlxdWVbIWlzLm5hKHNvY19jb2xsYWJzX3VuaXF1ZSldDQpzYXZlKHNvY19jb2xsYWJzLCBmaWxlID0gInNvY19kZl9jb2xsYWJzMS5SRGF0YSIpICAjIHlvdSBub3RpY2UgdGhpcyB0YWtlcyBhIHdoaWxlLCBzbyB3ZSBzYXZlIHRoZSBkYXRhIGhlcmUNCmBgYA0KIyBuZXR3b3JrIGJhc2VkIG9uIHB1YmxpY2F0aW9ucy4gDQoNCkRlemUgdGlqZHNpbnRlcnZhbGxlbiB6aWpuIHdhYXJzY2hpam5saWprIHRlIGdyb290IQ0KDQpgYGB7cn0NCmxvYWQoInNvY19kZl9jb2xsYWJzMS5SRGF0YSIpDQpgYGANCg0KDQpgYGB7cn0NCmxpYnJhcnkoc3RyaW5ncikNCg0KI2VtcHR5IGFkamFjZW5jeSBtYXRyaXggZm9yIHRoZSB5ZWFycyAyMDAxLTIwMDcNCm5ldHdvcmsyMDAxXzIwMDcgPC0gbWF0cml4KE5BLCBucm93PW5yb3coc29jX2RmKSwgbmNvbD1ucm93KHNvY19kZikpDQoNCiNzZWxlY3QgcHVibGljYXRpb25zIG9mIHRoZSBjb3JyZXNwb25kaW5nIHRpbWUgZXJhDQpwdWJzX3NlbCA8LSBzb2NfZGZfcHVibGljYXRpb25zICU+JQ0KICAgICAgICAgICAgICBtdXRhdGUoYXV0aG9yID0gdG9sb3dlcihhdXRob3IpKSAlPiUNCiAgICAgICAgICAgICAgZmlsdGVyKHllYXI+MjAwMCAmIHllYXI8MjAwOCkNCg0Kc2F2ZShwdWJzX3NlbCwgZmlsZSA9ICJzb2NfcHVic19zZWxfMjAwMV8yMDA3LlJEYXRhIikNCg0KI2ZpbGwgdGhlIG1hdHJpeA0KZm9yIChlZ28gaW4gMTogbnJvdyhzb2NfZGYpKSB7DQogIG5hbWVfZWdvIDwtIHNvY19kZiRsYXN0X25hbWVbZWdvXSAjd2hpY2ggZWdvPyANCiAgcHVic19zZWwyIDwtIHB1YnNfc2VsW3N0cl9kZXRlY3QocHVic19zZWwkYXV0aG9yLCBuYW1lX2VnbyksXSAjcHVibGljYXRpb25zIG9mIGVnbw0KICBmb3IgKGFsdGVyIGluIDE6bnJvdyhzb2NfZGYpKXsNCiAgICBuYW1lX2FsdGVyIDwtIHNvY19kZiRsYXN0X25hbWVbYWx0ZXJdICN3aGljaCBhbHRlcj8gDQogICAgbmV0d29yazIwMDFfMjAwN1tlZ28sYWx0ZXJdIDwtIHN1bShzdHJfZGV0ZWN0KHB1YnNfc2VsMiRhdXRob3IsIG5hbWVfYWx0ZXIpKSA+IDEgI2RpZCBhbHRlciBwdWJsaXNoIHdpdGggZWdvDQogIH0NCn0NCg0Kc2F2ZShuZXR3b3JrMjAwMV8yMDA3LCBmaWxlID0gInNvY19uZXR3b3JrMjAwMV8yMDA3LlJEYXRhIikNCg0KYGBgDQoNCmBgYHtyfQ0KbGlicmFyeShzdHJpbmdyKQ0KDQojZW1wdHkgYWRqYWNlbmN5IG1hdHJpeCBmb3IgdGhlIHllYXJzIDIwMDgtMjAxNA0KbmV0d29yazIwMDhfMjAxNCA8LSBtYXRyaXgoTkEsIG5yb3c9bnJvdyhzb2NfZGYpLCBuY29sPW5yb3coc29jX2RmKSkNCg0KI3NlbGVjdCBwdWJsaWNhdGlvbnMgb2YgdGhlIGNvcnJlc3BvbmRpbmcgdGltZSBlcmENCnB1YnNfc2VsIDwtIHNvY19kZl9wdWJsaWNhdGlvbnMgJT4lDQogICAgICAgICAgICAgIG11dGF0ZShhdXRob3IgPSB0b2xvd2VyKGF1dGhvcikpICU+JQ0KICAgICAgICAgICAgICBmaWx0ZXIoeWVhcj4yMDA3ICYgeWVhcjwyMDE1KQ0KDQpzYXZlKHB1YnNfc2VsLCBmaWxlID0gInNvY19wdWJzX3NlbF8yMDA4XzIwMTQuUkRhdGEiKQ0KDQojZmlsbCB0aGUgbWF0cml4DQpmb3IgKGVnbyBpbiAxOiBucm93KHNvY19kZikpIHsNCiAgbmFtZV9lZ28gPC0gc29jX2RmJGxhc3RfbmFtZVtlZ29dICN3aGljaCBlZ28/IA0KICBwdWJzX3NlbDIgPC0gcHVic19zZWxbc3RyX2RldGVjdChwdWJzX3NlbCRhdXRob3IsIG5hbWVfZWdvKSxdICNwdWJsaWNhdGlvbnMgb2YgZWdvDQogIGZvciAoYWx0ZXIgaW4gMTpucm93KHNvY19kZikpew0KICAgIG5hbWVfYWx0ZXIgPC0gc29jX2RmJGxhc3RfbmFtZVthbHRlcl0gI3doaWNoIGFsdGVyPyANCiAgICBuZXR3b3JrMjAwOF8yMDE0W2VnbyxhbHRlcl0gPC0gc3VtKHN0cl9kZXRlY3QocHVic19zZWwyJGF1dGhvciwgbmFtZV9hbHRlcikpID4gMSAjZGlkIGFsdGVyIHB1Ymxpc2ggd2l0aCBlZ28NCiAgfQ0KfQ0KDQpzYXZlKG5ldHdvcmsyMDA4XzIwMTQsIGZpbGUgPSAic29jX25ldHdvcmsyMDA4XzIwMTQuUkRhdGEiKQ0KDQpgYGANCg0KYGBge3J9DQpsaWJyYXJ5KHN0cmluZ3IpDQoNCiNlbXB0eSBhZGphY2VuY3kgbWF0cml4IGZvciB0aGUgeWVhcnMgMjAxNS0yMDIxDQpuZXR3b3JrMjAxNV8yMDIxIDwtIG1hdHJpeChOQSwgbnJvdz1ucm93KHNvY19kZiksIG5jb2w9bnJvdyhzb2NfZGYpKQ0KDQojc2VsZWN0IHB1YmxpY2F0aW9ucyBvZiB0aGUgY29ycmVzcG9uZGluZyB0aW1lIGVyYQ0KcHVic19zZWwgPC0gc29jX2RmX3B1YmxpY2F0aW9ucyAlPiUNCiAgICAgICAgICAgICAgbXV0YXRlKGF1dGhvciA9IHRvbG93ZXIoYXV0aG9yKSkgJT4lDQogICAgICAgICAgICAgIGZpbHRlcih5ZWFyPjIwMTQgJiB5ZWFyPDIwMjIpDQoNCnNhdmUocHVic19zZWwsIGZpbGUgPSAic29jX3B1YnNfc2VsXzIwMTVfMjAyMS5SRGF0YSIpDQoNCiNmaWxsIHRoZSBtYXRyaXgNCmZvciAoZWdvIGluIDE6IG5yb3coc29jX2RmKSkgew0KICBuYW1lX2VnbyA8LSBzb2NfZGYkbGFzdF9uYW1lW2Vnb10gI3doaWNoIGVnbz8gDQogIHB1YnNfc2VsMiA8LSBwdWJzX3NlbFtzdHJfZGV0ZWN0KHB1YnNfc2VsJGF1dGhvciwgbmFtZV9lZ28pLF0gI3B1YmxpY2F0aW9ucyBvZiBlZ28NCiAgZm9yIChhbHRlciBpbiAxOm5yb3coc29jX2RmKSl7DQogICAgbmFtZV9hbHRlciA8LSBzb2NfZGYkbGFzdF9uYW1lW2FsdGVyXSAjd2hpY2ggYWx0ZXI/IA0KICAgIG5ldHdvcmsyMDE1XzIwMjFbZWdvLGFsdGVyXSA8LSBzdW0oc3RyX2RldGVjdChwdWJzX3NlbDIkYXV0aG9yLCBuYW1lX2FsdGVyKSkgPiAxICNkaWQgYWx0ZXIgcHVibGlzaCB3aXRoIGVnbw0KICB9DQp9DQoNCnNhdmUobmV0d29yazIwMTVfMjAyMSwgZmlsZSA9ICJzb2NfbmV0d29yazIwMTVfMjAyMS5SRGF0YSIpDQpgYGANCg0K</div>


</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->
<script>
$(document).ready(function () {
  window.initializeSourceEmbed("RU_lab.Rmd");
  window.initializeCodeFolding("show" === "show");
});
</script>

<script>
$(document).ready(function ()  {

    // temporarily add toc-ignore selector to headers for the consistency with Pandoc
    $('.unlisted.unnumbered').addClass('toc-ignore')

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_');
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
